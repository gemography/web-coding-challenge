<?php

namespace CTRV\CommonBundle\Entity;

use CTRV\CommonBundle\DependencyInjection\Constants;

use Doctrine\ORM\EntityRepository;
use Doctrine\ORM\Mapping as ORM;

/**
 * AbuseRepository
 *
 * This class was generated by the Doctrine ORM. Add your own custom
 * repository methods below.
 */
class AbuseRepository extends EntityRepository
{
	
	public function getAllPublicMessageAbuses($city, $first, $last) {
		$qb= $this->createQueryBuilder("a")
		->select("a.entityType, pm.content, pm.date, pm.id")
		->from('CTRV\FlowBundle\Entity\PublicMessage','pm')
		->where("a.entityId=pm.id")
		->orderBy("a.id","desc")
		->setFirstResult($first)
		->setMaxResults($last)
		;
		
		return $qb->getQuery()->getResult();
	}
	
	public function getAllCommentAbuses($city, $first, $last) {
		$qb= $this->createQueryBuilder("a")
		->select("a.entityType, c.content,c.date, c.id")
		->from('CTRV\CommonBundle\Entity\Comment','c')
		->where("a.entityId=c.id")
		->orderBy("a.id","desc")
		->setFirstResult($first)
		->setMaxResults($last)
		;
	
		return $qb->getQuery()->getResult();
	}

	/**
	 * Retourne le nombre total d'abus
	 * @param unknown_type $city
	 */
	public function getAllAbuseNumber($city){
		$qb= $this->createQueryBuilder("a")
		->select('count(a)');
		return $qb->getQuery()->getSingleScalarResult();
	}
}
