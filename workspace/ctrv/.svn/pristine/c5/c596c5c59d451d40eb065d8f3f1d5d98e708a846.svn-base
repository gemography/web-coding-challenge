<?php

namespace CTRV\CommonBundle\Entity;

use CTRV\CommonBundle\DependencyInjection\Constants;

use Doctrine\ORM\EntityRepository;
use Doctrine\ORM\Mapping as ORM;

/**
 * AbuseRepository
 *
 * This class was generated by the Doctrine ORM. Add your own custom
 * repository methods below.
 */
class AbuseRepository extends EntityRepository
{
	public function getAllAbuse($city){
 $qb= $this->createQueryBuilder("a")
 ->select('a.id,a.entityId')
 ->from('CTRV\CommonBundle\Entity\Comment','c')
 ->from('CTRV\FlowBundle\Entity\PublicMessage','pm')
 ->from('CTRV\EventBundle\Entity\Event','e')
 ->from('CTRV\PlaceBundle\Entity\Place','p')
 ->addSelect('c.content,a.entityType')
 ->where("a.entityId=c.id OR a.entityId=pm.id")
 ->andWhere("pm.city=?1 OR e.city=?1 OR p.city=?1")
 ->orderBy('a.entityType','DESC')
 ->setParameter(1,$city)
 ->groupBy('a.entityId')
 ;
 return $qb->getQuery()->getResult();
}
}
