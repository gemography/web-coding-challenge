<?php

namespace CTRV\CommonBundle\Entity;

use CTRV\CommonBundle\DependencyInjection\Constants;

use Doctrine\ORM\EntityRepository;
use Doctrine\ORM\Mapping as ORM;

/**
 * AbuseRepository
 *
 * This class was generated by the Doctrine ORM. Add your own custom
 * repository methods below.
 */
class AbuseRepository extends EntityRepository
{
	public function getAllAbuse(){
 $qb= $this->createQueryBuilder("a")
 ->select('a.id,a.entityId')
 ->from('CTRV\CommonBundle\Entity\Comment','c')
 ->from('CTRV\FlowBundle\Entity\PublicMessage','pm')
 ->addSelect('c.content,a.entityType')
 ->where("a.entityId=c.id OR a.entityId=pm.id")
 ->orderBy('a.entityType','DESC')
 ->groupBy('a.entityId')
 ;
 return $qb->getQuery()->getResult();
}
}
