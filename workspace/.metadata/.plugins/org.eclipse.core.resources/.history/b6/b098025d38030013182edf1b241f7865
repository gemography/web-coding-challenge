<?php

namespace CTRV\CommonBundle\Entity;

use Doctrine\ORM\EntityRepository;

/**
 * NoteRepository
 *
 * This class was generated by the Doctrine ORM. Add your own custom
 * repository methods below.
 */
class ConnectedUsersRepository extends EntityRepository
{
	
	
	/**
	 * Retourne la liste des utilisateurs connectés
	 */
	public function getUsersConnectedNumber () {
		$qb = $this->createQueryBuilder("cu")
		->from('CTRV\CommonBundle\Entity\User','u')
		->where("cu.id=u.userid")
		->select ('count(cu)')
		;
		return $qb->getQuery()->getSingleScalarResult();
	}
	
	/**
	 * Retourne la liste des utilisateurs connectés de la ville courante
	 */
	public function getUsersConnectedNumberByCity ($city, $first, $last) {
		$qb = $this->createQueryBuilder("cu")
		->select (cu)
		->from('CTRV\CommonBundle\Entity\User','u')
		->where("cu.id=u.userid")
		->andWhere("u.city=?1")
		->setParameter(1, $city)
		->setFirstResult($first)
		->setMaxResults($last)
		;
		return $qb->getQuery()->getResult();
	}
	
	
	/**
	 * Retourne le nombre d'utilisateurs connectés de la ville courante
	 */
	public function getUsersConnectedNumberByCity ($city) {
		$qb = $this->createQueryBuilder("cu")
		->select ('count(cu)')
		->from('CTRV\CommonBundle\Entity\User','u')
		->where("cu.id=u.userid")
		->andWhere("u.city=?1")
		->setParameter(1, $city)
		;
		return $qb->getQuery()->getSingleScalarResult();
	}
	
	
}
